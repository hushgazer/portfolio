run: |
  sudo apt-get update -y
  sudo apt-get install -y webp imagemagick

  mkdir -p images_inv
  mkdir -p images_webp

  # Convert each image to a single optimized .webp at quality 40
  for src in images_inv/*; do
    base=$(basename "$src")
    if [[ "$base" == ".gitkeep" || "$base" == "images.json" ]]; then
      continue
    fi

    ext="${base##*.}"
    name_noext="${base%.*}"

    case "$ext" in
      png|jpg|jpeg|PNG|JPG|JPEG)
        out="images_webp/${name_noext}.webp"
        if [ ! -f "$out" ]; then
          magick "$src" -quality 40 "$out" || cwebp -q 40 "$src" -o "$out"
        fi
        ;;
    esac
  done

  # Build images.json with ONLY .webp files
  echo '[' > images_inv/images.json
  first=true
  for file in images_webp/*.webp; do
    b=$(basename "$file")
    if [ "$first" = false ]; then
      echo ',' >> images_inv/images.json
    fi
    printf '  "%s"' "$b" >> images_inv/images.json
    first=false
  done
  echo '' >> images_inv/images.json
  echo ']' >> images_inv/images.json
